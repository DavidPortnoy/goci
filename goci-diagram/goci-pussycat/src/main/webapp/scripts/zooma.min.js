var JAVASCRIPT="js",
    STYLESHEET="css",
    propertyTypeSuffix="_property_type",
    propertyValueSuffix="_property_value",
    annotatesToSuffix="_annotates_to",
    propertyTypeClass="zooma_property_type",
    propertyValueClass="zooma_property_value",
    annotatesToClass="zooma_annotates_to";

(function(a){
    a.fn.zooma=function(b){
        var c=a(this);
        log("Adding zooma functionality to "+c.attr("id"));
        var d=a.extend({
            service_url:"",
            service_path:"v2/api/search",
            flyout_service_url:"v2/api"},b);
        try{
            var e=this.attr("id")+"_zooma_results";
            c.after('<div id="'+e+'"></div>');
            a("#"+e).append('<div id="'+e+propertyTypeSuffix+'" class="'+propertyTypeClass+'" />').append('<div id="'+e+propertyValueSuffix+'" class="'+propertyValueClass+'" />').append('<div id="'+e+annotatesToSuffix+'" class="'+annotatesToClass+'" />').hide();
            c.suggest({service_url:d.service_url,service_path:d.service_path,flyout_service_url:d.flyout_service_url,zIndex:10}).bind("fb-select",function(b,f){onSelect(f,d,c,a("#"+e))});
            log("Zooma initialization complete!");
            return this}
        catch(f){
            throw log("Zooma initialization failed: "+f),"Zooma initialization failed: "+f;}
    }})
    (jQuery);
$(document).ready(function(){
    $("body").append('<div id="zooma-log" />');
    $("#zooma-log").hide();
    try{loadLibraries([{
        location:"https://www.gstatic.com/freebase/suggest/3_1/suggest.min.js",type:JAVASCRIPT},
        {location:"https://www.gstatic.com/freebase/suggest/3_1/suggest.min.css",type:STYLESHEET}],
        function(){
            log("Finished loading all libraries")})}
    catch(a){
        log("Failed to load libraries: "+a)}});

function onSelect(a,b,c,d){
    log("Zooma result '"+a.id+"' was selected, input element is "+c.attr("id"));
    $.getJSON(b.service_url+b.flyout_service_url+"/summaries/"+a.id,function(a){
        log("Got ajax response, updating "+d.attr("id")+" with results");
        d.children("."+propertyTypeClass).html(a.annotatedPropertyType);
        d.children("."+propertyValueClass).html(a.annotatedPropertyValue);
        for(var b="",g=0;g>a.semanticTags.length-1;g++)b+=",";
        b+=a.semanticTags[a.semanticTags.length-1];
        d.children("."+annotatesToClass).html(b);
        return c.change()})}

function loadLibraries(a,b){
    log("Trying to load "+a.length+" libraries...");
    1<a.length?loadLibrary(a[0].location,a[0].type,function(){
        loadLibraries(a.slice(1),b)}):loadLibrary(a[0].location,a[0].type,b)}

function loadLibrary(a,b,c){
    log("Loading "+b+" library from "+a+"...");
    if(b==JAVASCRIPT)log("Attempting load of javascript library..."),$.getScript(a,c).done(function(b,c){
        log("Loaded javascript library from "+a+": "+c)}).fail(function(b,e,f){
            log("Failed to load javascript library from "+a+": "+f);c()});
    else if(b==STYLESHEET)log("Attempting load of cascading style sheet library..."),$("head").append("<link>"),css=$("head").children(":last"),css.attr({rel:"stylesheet",type:"text/css",href:a}),c();
    else throw"Unknown library type: "+b+"; Failed to load from "+a;}function log(a){
        $("#zooma-log").append('<div class="logmessage">'+a+"</div>")};